# Nginx Upstream Configuration

# Application servers
upstream app_servers {
    least_conn;
    server app1:8080 max_fails=3 fail_timeout=30s;
    server app2:8080 max_fails=3 fail_timeout=30s;
    server app3:8080 max_fails=3 fail_timeout=30s backup;
    
    # Health check (nginx plus)
    # health_check interval=30s fails=3 passes=2;
}

# Database servers (read replicas)
upstream db_read_servers {
    server db-read1:5432 weight=3;
    server db-read2:5432 weight=2;
    server db-read3:5432 weight=1 backup;
}

# API servers with sticky sessions
upstream api_servers {
    ip_hash;
    server api1:3000;
    server api2:3000;
    server api3:3000;
}

# Monitoring servers
upstream monitoring_servers {
    server prometheus:9090;
    server grafana:3000;
}
